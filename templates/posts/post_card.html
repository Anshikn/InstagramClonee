{% load static %}

<div class="post-card">

    <!-- Post Header -->
    <div class="post-header">
        <a href="{% url 'profile_detail' post.user.username %}">
            <img class="profile-img"
                 src="{% if post.user.profile.profile_image %}{{ post.user.profile.profile_image.url }}{% else %}{% static 'images/default-profile.png' %}{% endif %}"
                 alt="profile">
        </a>
        <strong>
            <a href="{% url 'profile_detail' post.user.username %}">{{ post.user.username }}</a>
        </strong>
    </div>

    <!-- Post Image -->
    <div class="post-image">
        <img src="{{ post.image.url }}" alt="post image">
    </div>

    <!-- Like Button -->
    <form method="post" action="{% url 'toggle-like' post.id %}">
        {% csrf_token %}
        <button type="submit" class="like-btn">
            {% if request.user in post.likes.all %}
                ‚ù§Ô∏è
            {% else %}
                ü§ç
            {% endif %}
        </button>

        <span>{{ post.likes.count }} likes</span>
    </form>

    <!-- Caption -->
    <div class="post-caption">
        <strong><a href="{% url 'profile_detail' post.user.username %}">{{ post.user.username }}</a></strong>
        {{ post.caption }}
    </div>

    <!-- Comments -->
    <div class="comments-section">

        {% for comment in post.comments.all|slice:":3" %}
            <p>
                <strong>{{ comment.user }}</strong>
                {{ comment.text }}

                {% if comment.user == request.user %}
                    <a href="{% url 'delete-comment' comment.id %}">‚ùå</a>
                {% endif %}
            </p>
        {% endfor %}

        {% if post.comments.count > 3 %}
            <a href="{% url 'comment-list' post.id %}">
                View all {{ post.comments.count }} comments
            </a>
        {% endif %}

        {% if user.is_authenticated %}
            <form method="post" action="{% url 'add-comment' post.id %}">
                {% csrf_token %}
                <input type="text" name="text" placeholder="Add a comment..." required>
            </form>
        {% endif %}
    </div>

</div>
